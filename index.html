<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5 A√±os Contigo</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=Dancing+Script:wght@600;700&family=Lato:wght@300;400&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 1.5rem;
            overflow-x: hidden;
            font-family: 'Playfair Display', serif;
            background: linear-gradient(160deg,
                #6b2d8b 0%, #9c3aaa 18%, #d4507e 38%,
                #e06888 55%, #9c3aaa 75%, #5a1a80 100%);
            background-size: 300% 300%;
            animation: gradientShift 12s ease infinite;
            transition: background 5s ease;
        }
        @keyframes gradientShift {
            0%   { background-position: 0% 50%; }
            50%  { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .floaters { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
        .floater {
            position: absolute; opacity: 0; user-select: none; line-height: 1;
            animation: floatUp linear infinite;
        }
        @keyframes floatUp {
            0%   { transform: translateY(110vh) rotate(0deg); opacity: 0; }
            10%  { opacity: 0.5; }
            90%  { opacity: 0.35; }
            100% { transform: translateY(-15vh) rotate(360deg); opacity: 0; }
        }

        .glow {
            position: fixed; width: 75vw; height: 75vh;
            background: radial-gradient(ellipse, rgba(255,190,215,0.2) 0%, transparent 70%);
            top: 50%; left: 50%; transform: translate(-50%,-50%);
            pointer-events: none; z-index: 0;
            animation: breathe 9s ease-in-out infinite;
        }
        @keyframes breathe {
            0%,100% { opacity: 0.5; transform: translate(-50%,-50%) scale(1); }
            50%      { opacity: 1;   transform: translate(-50%,-50%) scale(1.1); }
        }

        .card {
            position: relative; z-index: 2; width: 100%; max-width: 720px;
            background: rgba(255,240,248,0.14);
            border: 1.5px solid rgba(255,210,230,0.4);
            border-radius: 2.5rem; padding: 5rem 4rem; text-align: center;
            backdrop-filter: blur(24px);
            box-shadow: 0 0 0 1px rgba(255,180,210,0.1), 0 55px 130px rgba(70,5,35,0.55), inset 0 1px 0 rgba(255,255,255,0.2);
            transition: max-width 1.5s ease, background 4s ease, border-color 4s ease, box-shadow 4s ease;
        }
        .card.expanded { max-width: 820px; }
        .card.revealed {
            background: rgba(255,248,253,0.97) !important;
            border-color: rgba(255,160,200,0.6) !important;
            box-shadow: 0 50px 160px rgba(200,70,120,0.3) !important;
        }

        .corner-ornament { position: absolute; font-size: 2.2rem; opacity: 0.5; line-height: 1; }
        .corner-ornament.tl { top: 1.3rem; left: 1.6rem; transform: rotate(-20deg); }
        .corner-ornament.tr { top: 1.3rem; right: 1.6rem; transform: rotate(20deg); }
        .corner-ornament.bl { bottom: 1.3rem; left: 1.6rem; transform: rotate(15deg); }
        .corner-ornament.br { bottom: 1.3rem; right: 1.6rem; transform: rotate(-15deg); }

        .step { display: none; opacity: 0; transition: opacity 0.9s ease; }
        .step.active { display: block; opacity: 1; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        .su1 { animation: slideUp 1.1s 0.1s forwards; opacity: 0; }
        .su2 { animation: slideUp 1.1s 0.4s forwards; opacity: 0; }
        .su3 { animation: slideUp 1.1s 0.7s forwards; opacity: 0; }

        .eyebrow {
            font-family: 'Lato', sans-serif;
            font-size: clamp(0.78rem, 1.8vw, 1rem);
            font-weight: 300; letter-spacing: 0.55em; text-transform: uppercase;
            color: rgba(255,230,242,0.82); margin-bottom: 1.5rem;
        }
        .big-title {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(4rem, 13vw, 8rem);
            font-weight: 700; line-height: 1; color: #fff;
            text-shadow: 0 4px 35px rgba(255,120,170,0.5), 0 0 80px rgba(255,200,225,0.25);
            margin-bottom: 0.4rem;
        }
        .tagline {
            font-family: 'Playfair Display', serif; font-style: italic;
            font-size: clamp(1.25rem, 3.2vw, 2rem);
            color: rgba(255,230,242,0.72); margin-bottom: 2.5rem;
        }
        .divider {
            display: flex; align-items: center; gap: 0.8rem;
            justify-content: center; margin: 0 auto 2.8rem;
        }
        .divider-line { width: 65px; height: 1px; background: linear-gradient(90deg, transparent, rgba(255,200,225,0.8), transparent); }
        .divider-icon { font-size: 1.3rem; opacity: 0.85; }
        .intro-text {
            font-family: 'Playfair Display', serif; font-style: italic;
            font-size: clamp(1.15rem, 3vw, 1.65rem);
            color: rgba(255,228,242,0.72); line-height: 1.9; margin-bottom: 3rem;
        }

        .input-wrap { max-width: 400px; margin: 0 auto 2.8rem; }
        input[type="text"] {
            width: 100%; background: transparent; border: none;
            border-bottom: 1.5px solid rgba(255,200,225,0.5);
            padding: 1rem 0; color: #fff;
            font-family: 'Dancing Script', cursive;
            font-size: clamp(1.6rem, 4.5vw, 2.4rem);
            text-align: center; letter-spacing: 0.08em; outline: none;
            transition: border-color 0.3s;
        }
        input::placeholder {
            color: rgba(255,255,255,0.28); font-family: 'Lato', sans-serif;
            font-size: clamp(0.85rem, 2vw, 1.05rem); letter-spacing: 0.38em; font-weight: 300;
        }
        input:focus { border-bottom-color: rgba(255,200,225,0.95); }

        .btn {
            font-family: 'Lato', sans-serif;
            font-size: clamp(0.8rem, 1.9vw, 1rem); font-weight: 400;
            letter-spacing: 0.38em; text-transform: uppercase;
            padding: 1.35rem 3.8rem;
            border: 1.5px solid rgba(255,200,225,0.5);
            color: rgba(255,235,247,0.95);
            background: rgba(255,255,255,0.07);
            cursor: pointer; border-radius: 100px; transition: all 0.4s ease;
        }
        .btn:hover {
            border-color: rgba(255,200,225,1); color: #fff;
            background: rgba(255,140,185,0.18);
            box-shadow: 0 0 45px rgba(255,110,160,0.35);
            transform: translateY(-3px);
        }
        .btn-reveal {
            font-size: clamp(0.9rem, 2.1vw, 1.08rem); padding: 1.8rem 5rem;
            animation: roseGlow 2.5s ease-in-out infinite;
        }
        @keyframes roseGlow {
            0%,100% { box-shadow: 0 0 25px rgba(255,110,160,0.2); }
            50%      { box-shadow: 0 0 65px rgba(255,110,160,0.55); }
        }
        .error-msg {
            font-family: 'Lato', sans-serif; font-size: 0.78rem;
            letter-spacing: 0.22em; color: rgba(255,200,225,0.65);
            text-transform: uppercase; min-height: 1.5rem; margin-top: 1.5rem;
        }

        .hint-counter {
            font-family: 'Lato', sans-serif;
            font-size: clamp(0.7rem, 1.7vw, 0.88rem); font-weight: 300;
            letter-spacing: 0.52em; color: rgba(255,210,235,0.58);
            text-transform: uppercase; margin-bottom: 2rem;
        }
        .hint-inner {
            display: flex; flex-direction: column; align-items: center;
            gap: 2rem; padding: 0 0.5rem; min-height: 220px; justify-content: center;
        }
        .hint-text {
            font-family: 'Playfair Display', serif; font-style: italic;
            font-size: clamp(1.5rem, 4.2vw, 2.6rem); font-weight: 400;
            line-height: 1.65; color: #fff;
            text-shadow: 0 2px 20px rgba(255,110,160,0.25);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .hint-text.fade-out { opacity: 0; transform: translateY(-25px); }

        .hint-photo {
            width: 100%; max-width: 480px; border-radius: 1.5rem; overflow: hidden;
            position: relative;
            box-shadow: 0 20px 60px rgba(80,5,40,0.55), 0 0 0 3px rgba(255,200,230,0.3);
            opacity: 0; transform: translateY(20px) scale(0.97); flex-shrink: 0;
            transition: opacity 0.8s ease 0.2s, transform 0.8s ease 0.2s;
        }
        .hint-photo.visible { opacity: 1; transform: translateY(0) scale(1); }
        .hint-photo img { width: 100%; height: 300px; object-fit: cover; display: block; }
        .hint-photo-caption {
            position: absolute; bottom: 0; left: 0; right: 0; padding: 1.2rem 1.5rem;
            background: linear-gradient(to top, rgba(120,30,70,0.85), transparent);
            font-family: 'Dancing Script', cursive; font-size: clamp(1.1rem, 3vw, 1.5rem);
            color: #fff; text-shadow: 0 2px 8px rgba(0,0,0,0.4);
            opacity: 0; transition: opacity 0.5s ease 0.6s;
        }
        .hint-photo.visible .hint-photo-caption { opacity: 1; }

        .dots { display: flex; gap: 0.7rem; justify-content: center; margin: 2rem 0; }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: rgba(255,200,225,0.22); transition: all 0.4s; }
        .dot.active { background: rgba(255,200,225,0.95); transform: scale(1.55); box-shadow: 0 0 8px rgba(255,140,185,0.6); }

        .reveal-title {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(3rem, 8.5vw, 6rem); font-weight: 700; color: #fff;
            text-shadow: 0 4px 30px rgba(255,110,160,0.4); margin-bottom: 1.2rem; line-height: 1.1;
        }
        .reveal-sub {
            font-family: 'Playfair Display', serif; font-style: italic;
            font-size: clamp(1.25rem, 3.2vw, 1.85rem);
            color: rgba(255,228,242,0.68); margin-bottom: 4.5rem; line-height: 1.85;
        }

        .final-badge {
            display: inline-block;
            background: linear-gradient(135deg, #f472b6, #c026d3, #9333ea);
            color: white; font-family: 'Lato', sans-serif;
            font-size: clamp(0.82rem, 2vw, 1.02rem); font-weight: 400;
            letter-spacing: 0.38em; text-transform: uppercase;
            padding: 0.9rem 2.8rem; border-radius: 100px; margin-bottom: 2.2rem;
            box-shadow: 0 8px 30px rgba(192,38,211,0.3);
        }
        .final-headline {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(3rem, 10vw, 6.5rem); font-weight: 700; color: #be185d;
            line-height: 1.1; margin-bottom: 0.6rem; text-shadow: 0 4px 20px rgba(190,24,93,0.2);
        }
        .final-sub {
            font-family: 'Playfair Display', serif; font-style: italic;
            font-size: clamp(1.2rem, 3.2vw, 1.9rem); color: #9d4f75; margin-bottom: 2.8rem; line-height: 1.75;
        }
        .ultrasound-wrap { max-width: 820px; margin: 0 auto 3rem; position: relative; display: inline-block; }
        .ultrasound-img {
            width: 100%; height: auto; border-radius: 6px;
            border: 22px solid white; box-shadow: 0 30px 80px rgba(0,0,0,0.18);
            transform: rotate(1deg); transition: transform 0.8s ease; display: block;
        }
        .ultrasound-img:hover { transform: rotate(0deg) scale(1.02); }
        .deco-float { position: absolute; font-size: 4.5rem; animation: floatPop 3.2s ease-in-out infinite; }
        .deco-float.tr { top: -2.5rem; right: -1.8rem; animation-delay: 0.2s; }
        .deco-float.bl { bottom: -2.5rem; left: -1.8rem; animation-delay: 0.9s; }
        @keyframes floatPop {
            0%,100% { transform: translateY(0) scale(1); }
            50%      { transform: translateY(-14px) scale(1.08); }
        }
        .final-names {
            font-family: 'Dancing Script', cursive;
            font-size: clamp(2.5rem, 6.5vw, 4.5rem); color: #c026d3; margin-bottom: 0.4rem; line-height: 1.2;
        }
        .final-caption {
            font-family: 'Playfair Display', serif; font-style: italic;
            font-size: clamp(1.15rem, 2.8vw, 1.6rem); color: #9b5777; line-height: 1.8;
        }

        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; }

        @media (max-width: 600px) {
            .card { padding: 3.5rem 2rem; }
            .deco-float { font-size: 3rem; }
            .btn { padding: 1.25rem 2.5rem; }
            .hint-photo img { height: 220px; }
        }
    </style>
</head>
<body>
    <canvas id="confetti-canvas"></canvas>
    <div class="floaters" id="floaters"></div>
    <div class="glow"></div>

    <!--
        AUDIO: rutas relativas para GitHub Pages.
        Aseg√∫rate de que tu repo tenga la carpeta  assets/
        con los archivos  fondo.mp3  y  latido.mp3
    -->
    <audio id="bg-music" preload="auto">
        <source src="assets/fondo.mp3" type="audio/mpeg">
    </audio>
    <audio id="latido-audio" preload="auto">
        <source src="assets/latido.mp3" type="audio/mpeg">
    </audio>

    <div class="card" id="card">
        <span class="corner-ornament tl">üå∏</span>
        <span class="corner-ornament tr">üå∑</span>
        <span class="corner-ornament bl">üå∫</span>
        <span class="corner-ornament br">üíê</span>

        <!-- PASO 1: Login -->
        <div id="step-login" class="step active">
            <p class="eyebrow su1">para ti ¬∑ con todo mi amor</p>
            <h1 class="big-title su1">Amor M√≠o</h1>
            <p class="tagline su2">cinco a√±os escribiendo nuestra historia...</p>
            <div class="divider su2">
                <div class="divider-line"></div>
                <span class="divider-icon">üåπ</span>
                <div class="divider-line"></div>
            </div>
            <p class="intro-text su2">
                He guardado algo muy especial para este d√≠a.<br>
                Escribe tu nombre para abrir este sobre.
            </p>
            <div class="input-wrap su3">
                <input type="text" id="username" placeholder="TU NOMBRE" autocomplete="off">
            </div>
            <div class="su3">
                <button class="btn" onclick="startExperience()">üíå &nbsp; Abrir el sobre</button>
            </div>
            <p class="error-msg" id="login-error"></p>
        </div>

        <!-- PASO 2: Pistas -->
        <div id="step-hints" class="step">
            <p class="hint-counter" id="hint-counter">FRAGMENTO 1 DE 5</p>
            <div class="hint-inner" id="hint-inner"></div>
            <div class="dots" id="dots"></div>
            <button class="btn" onclick="nextHint()">Seguir leyendo ‚ú®</button>
        </div>

        <!-- PASO 3: Pre-reveal -->
        <div id="step-reveal" class="step">
            <p class="eyebrow">el momento m√°s importante</p>
            <h2 class="reveal-title">Hay algo que<br>quiero decirte...</h2>
            <p class="reveal-sub">Ninguna palabra ha sido suficiente.<br>Hasta ahora.</p>
            <button class="btn btn-reveal" onclick="showFinalMessage()">üå∏ &nbsp; Abrir mi coraz√≥n &nbsp; üå∏</button>
        </div>

        <!-- PASO 4: Final -->
        <div id="step-final" class="step">
            <div class="su1">
                <div class="final-badge">‚ú® 5 a√±os ¬∑ y apenas empezamos ‚ú®</div>
                <h1 class="final-headline">¬°Vamos a ser pap√°s!</h1>
                <p class="final-sub">
                    Porque amarte me ense√±√≥ que el coraz√≥n<br>
                    siempre tiene espacio para amar m√°s. üíï
                </p>
                <div class="ultrasound-wrap">
                    <img src="https://drive.google.com/thumbnail?id=1oDeS7wVSdueLK08jiCgB-ynVknV8tGcA&sz=w1000"
                         alt="Primera ecograf√≠a" class="ultrasound-img">
                    <span class="deco-float tr">üå∏</span>
                    <span class="deco-float bl">üë∂</span>
                </div>
                <div class="su2">
                    <p class="final-names">Kathe &amp; Kevin</p>
                    <p class="final-names" style="font-size:clamp(1.9rem,4.8vw,3.2rem);margin-bottom:1.8rem;color:#e879a0;">pronto seremos tres üçº</p>
                    <p class="final-caption">
                        Gracias por elegirme cada d√≠a, mi amor.<br>
                        Este es el regalo m√°s hermoso de nuestra historia. üíó
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
    /* ‚îÄ‚îÄ Floaters ‚îÄ‚îÄ */
    const SYMBOLS = ['üå∏','üå∑','üå∫','üíê','üåπ','üåº','üíó','üíï','üíñ','üíù','üíì','‚ú®'];
    const floaterWrap = document.getElementById('floaters');
    function spawnFloater() {
        const el = document.createElement('span');
        el.className = 'floater';
        el.innerText = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
        el.style.left = Math.random() * 100 + 'vw';
        el.style.fontSize = (1.3 + Math.random() * 2.4) + 'rem';
        const dur = 11 + Math.random() * 14;
        el.style.animationDuration = dur + 's';
        el.style.animationDelay    = (Math.random() * 5) + 's';
        floaterWrap.appendChild(el);
        setTimeout(() => el.remove(), (dur + 8) * 1000);
    }
    for (let i = 0; i < 24; i++) spawnFloater();
    setInterval(spawnFloater, 1700);

    /* ‚îÄ‚îÄ Pistas ‚îÄ‚îÄ */
    let currentHint = 0;
    const hints = [
        {
            text: "El amor verdadero no se detiene en el tiempo... se multiplica de maneras que jam√°s imaginamos.",
            photo: { src: "https://lh3.googleusercontent.com/d/1sP8T-co6JIAHqQVM7w5NyrYUMFEO_Pus", caption: "Tu sonrisa es mi lugar favorito." }
        },
        {
            text: "Desde el primer d√≠a supe que contigo, todo iba a ser diferente.",
            photo: null
        },
        {
            text: "Cada risa, cada abrazo, cada momento juntos ha sido un cap√≠tulo m√°gico en nuestra historia de amor.",
            photo: { src: "https://lh3.googleusercontent.com/d/14KY4OCBVl3kGQj-bcJYX96aG1lVDC92F", caption: "Por una eternidad de besos." }
        },
        {
            text: "Gracias por ense√±arme que amar es cuidar, respetar y crecer juntos. Eres el sue√±o del que nunca quiero despertar. Te amo m√°s de lo que las palabras podr√≠an expresar.",
            photo: null
        },
        {
            text: "Porque la historia m√°s bonita que hemos vivido juntos... apenas acaba de comenzar su cap√≠tulo m√°s especial.",
            photo: { src: "https://lh3.googleusercontent.com/d/13Ez30EDFETISs5KxwVbNc8x95lr_p__o", caption: "Donde sea, pero siempre contigo. üíï" }
        }
    ];

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       AUDIO ‚Äî Soluci√≥n para GitHub Pages
       Los navegadores modernos bloquean autoplay.
       La clave es iniciar el audio DENTRO del
       handler del clic del usuario, sin awaits
       ni callbacks intermedios.
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    const bgMusic = document.getElementById('bg-music');
    const latido  = document.getElementById('latido-audio');

    // Desbloquear AudioContext (requerido en Safari / iOS)
    function unlockAudioContext() {
        const AC = window.AudioContext || window.webkitAudioContext;
        if (!AC) return;
        const ctx = new AC();
        // Buffer silencioso de 1 muestra para abrir el contexto
        const buf = ctx.createBuffer(1, 1, 22050);
        const src = ctx.createBufferSource();
        src.buffer = buf;
        src.connect(ctx.destination);
        src.start(0);
        ctx.resume().catch(() => {});
    }

    // Fade gradual de volumen
    function fadeTo(audio, targetVol, durationMs) {
        const startVol = audio.volume;
        const diff     = targetVol - startVol;
        const steps    = 40;
        const interval = durationMs / steps;
        let step = 0;
        const timer = setInterval(() => {
            step++;
            audio.volume = Math.min(1, Math.max(0, startVol + diff * (step / steps)));
            if (step >= steps) clearInterval(timer);
        }, interval);
    }

    /* ‚îÄ‚îÄ Navegaci√≥n entre pasos ‚îÄ‚îÄ */
    function showStep(fromId, toId) {
        const from = document.getElementById(fromId);
        const to   = document.getElementById(toId);
        from.style.opacity = '0';
        setTimeout(() => {
            from.classList.remove('active');
            to.classList.add('active');
            requestAnimationFrame(() => requestAnimationFrame(() => { to.style.opacity = '1'; }));
        }, 800);
    }

    /* ‚îÄ‚îÄ PASO 1 ‚Üí 2: inicio con m√∫sica ‚îÄ‚îÄ */
    function startExperience() {
        const name = document.getElementById('username').value.trim();
        if (name.length < 2) {
            document.getElementById('login-error').innerText = 'Escribe tu nombre para continuar üå∏';
            return;
        }

        // CR√çTICO: el play() debe llamarse DIRECTAMENTE en el evento clic,
        // sin pasar por async/await ni setTimeout.
        unlockAudioContext();
        bgMusic.loop   = true;
        bgMusic.volume = 0.38;
        bgMusic.play().catch(e => console.warn('BG audio:', e));

        buildDots();
        renderHint(false);
        showStep('step-login', 'step-hints');
    }

    /* ‚îÄ‚îÄ PASO 3 ‚Üí 4: detener m√∫sica, iniciar latido ‚îÄ‚îÄ */
    function showFinalMessage() {
        // Fade out m√∫sica de fondo en 2.5 s y luego pausar
        fadeTo(bgMusic, 0, 2500);
        setTimeout(() => {
            bgMusic.pause();
            bgMusic.currentTime = 0;
        }, 2700);

        // Iniciar latido directamente en el clic (CR√çTICO para navegadores)
        unlockAudioContext();
        latido.loop   = true;
        latido.volume = 0;
        latido.play().catch(e => console.warn('Latido audio:', e));
        fadeTo(latido, 0.78, 2800);

        // Transici√≥n visual
        document.body.style.animation  = 'none';
        document.body.style.background = 'linear-gradient(160deg, #fce4ec 0%, #fdf2f8 40%, #fce7f3 70%, #fdf4ff 100%)';
        document.getElementById('card').classList.add('revealed', 'expanded');
        showStep('step-reveal', 'step-final');
        setTimeout(launchConfetti, 1100);
    }

    /* ‚îÄ‚îÄ Pistas: render y navegaci√≥n ‚îÄ‚îÄ */
    function buildDots() {
        const wrap = document.getElementById('dots');
        wrap.innerHTML = '';
        hints.forEach((_, i) => {
            const d = document.createElement('span');
            d.className = 'dot' + (i === 0 ? ' active' : '');
            wrap.appendChild(d);
        });
    }

    function renderHint(animate) {
        const inner = document.getElementById('hint-inner');
        const hint  = hints[currentHint];
        document.getElementById('hint-counter').innerText = `FRAGMENTO ${currentHint + 1} DE ${hints.length}`;
        inner.innerHTML = '';

        const textEl = document.createElement('p');
        textEl.className = 'hint-text';
        if (animate) textEl.classList.add('fade-out');
        textEl.innerText = hint.text;
        inner.appendChild(textEl);

        if (hint.photo) {
            const photoEl = document.createElement('div');
            photoEl.className = 'hint-photo';
            photoEl.innerHTML = `
                <img src="${hint.photo.src}" alt="Nuestro momento" loading="lazy">
                <div class="hint-photo-caption">${hint.photo.caption}</div>`;
            inner.appendChild(photoEl);
            requestAnimationFrame(() => requestAnimationFrame(() => {
                textEl.classList.remove('fade-out');
                setTimeout(() => photoEl.classList.add('visible'), 120);
            }));
        } else {
            requestAnimationFrame(() => requestAnimationFrame(() => {
                textEl.classList.remove('fade-out');
            }));
        }
    }

    function nextHint() {
        const textEl  = document.getElementById('hint-inner').querySelector('.hint-text');
        const photoEl = document.getElementById('hint-inner').querySelector('.hint-photo');
        if (textEl)  textEl.classList.add('fade-out');
        if (photoEl) { photoEl.classList.remove('visible'); photoEl.style.opacity = '0'; }

        setTimeout(() => {
            currentHint++;
            if (currentHint < hints.length) {
                document.querySelectorAll('.dot').forEach((d, i) => d.classList.toggle('active', i === currentHint));
                renderHint(true);
            } else {
                showStep('step-hints', 'step-reveal');
            }
        }, 500);
    }

    /* ‚îÄ‚îÄ Confetti ‚îÄ‚îÄ */
    function launchConfetti() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx    = canvas.getContext('2d');
        canvas.width  = window.innerWidth;
        canvas.height = window.innerHeight;

        const emojis = ['üå∏','üå∑','üíó','üíï','üíñ','üåπ','üå∫','üíù','‚ú®','üéâ','üéä','üåº','üíê','üë∂','üçº','üíì'];
        const colors = ['#f9a8d4','#f472b6','#ec4899','#db2777','#c026d3','#a855f7','#fbbf24','#f43f5e','#ffffff','#fde68a','#fbcfe8'];
        const particles = [];

        [[0.15,0.22],[0.5,0.05],[0.85,0.22]].forEach(([px,py], oi) => {
            setTimeout(() => {
                for (let i = 0; i < 90; i++) {
                    const a = Math.random()*Math.PI*2, s = Math.random()*14+5;
                    const isEmoji = Math.random() > 0.4;
                    particles.push({
                        x: canvas.width*px, y: canvas.height*py,
                        vx: Math.cos(a)*s, vy: Math.sin(a)*s - Math.random()*9,
                        color: colors[Math.floor(Math.random()*colors.length)],
                        emoji: isEmoji ? emojis[Math.floor(Math.random()*emojis.length)] : null,
                        size: Math.random()*10+5, emojiSize: Math.floor(Math.random()*22+18),
                        rot: Math.random()*360, rs: (Math.random()-0.5)*10,
                        g: 0.3, alpha: 1,
                        shape: ['rect','circle','heart'][Math.floor(Math.random()*3)]
                    });
                }
            }, oi * 280);
        });

        let rain = 0;
        (function addRain() {
            for (let i = 0; i < 5; i++) {
                const isEmoji = Math.random() > 0.35;
                particles.push({
                    x: Math.random()*canvas.width, y: -20,
                    vx: (Math.random()-0.5)*3, vy: Math.random()*5+2,
                    color: colors[Math.floor(Math.random()*colors.length)],
                    emoji: isEmoji ? emojis[Math.floor(Math.random()*emojis.length)] : null,
                    size: Math.random()*8+4, emojiSize: Math.floor(Math.random()*18+15),
                    rot: Math.random()*360, rs: (Math.random()-0.5)*6,
                    g: 0.12, alpha: 1, shape: ['rect','circle'][Math.floor(Math.random()*2)]
                });
            }
            if (++rain < 75) setTimeout(addRain, 100);
        })();

        (function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let alive = false;
            for (let i = particles.length-1; i >= 0; i--) {
                const p = particles[i];
                p.vy += p.g; p.x += p.vx; p.y += p.vy; p.rot += p.rs; p.alpha -= 0.0038;
                if (p.alpha <= 0 || p.y > canvas.height+30) { particles.splice(i,1); continue; }
                alive = true;
                ctx.save();
                ctx.globalAlpha = p.alpha;
                if (p.emoji) {
                    ctx.font = p.emojiSize + 'px serif';
                    ctx.translate(p.x, p.y);
                    ctx.rotate(p.rot * Math.PI/180);
                    ctx.fillText(p.emoji, -p.emojiSize/2, p.emojiSize/2);
                } else {
                    ctx.translate(p.x, p.y);
                    ctx.rotate(p.rot * Math.PI/180);
                    ctx.fillStyle = p.color;
                    if (p.shape === 'rect') {
                        ctx.fillRect(-p.size/2, -p.size/4, p.size, p.size/2);
                    } else if (p.shape === 'heart') {
                        const s = p.size * 0.4;
                        ctx.beginPath();
                        ctx.moveTo(0, s*0.7);
                        ctx.bezierCurveTo(-s*2,-s*0.5,-s*2,-s*2,0,-s);
                        ctx.bezierCurveTo(s*2,-s*2,s*2,-s*0.5,0,s*0.7);
                        ctx.fill();
                    } else {
                        ctx.beginPath(); ctx.arc(0,0,p.size/2,0,Math.PI*2); ctx.fill();
                    }
                }
                ctx.restore();
            }
            if (alive || particles.length) requestAnimationFrame(animate);
        })();
    }

    document.getElementById('username').addEventListener('keydown', e => {
        if (e.key === 'Enter') startExperience();
    });
    window.addEventListener('resize', () => {
        const c = document.getElementById('confetti-canvas');
        c.width = window.innerWidth; c.height = window.innerHeight;
    });
    </script>
</body>
</html>